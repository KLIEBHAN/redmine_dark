/* Deep Purple & Magenta Dark Mode
 * Fork: https://github.com/KLIEBHAN/redmine_dark
 * Original: https://github.com/fraoustin/redmine_dark
 */

/* ============================================
   CSS Custom Properties (Color Palette)
   ============================================ */
:root {
    --dark-bg: #1E1924;
    --dark-bg-light: #2A2430;
    --dark-accent: #C46B8C;
    --dark-accent-secondary: #D4849E;
    --dark-accent-light: #E09DB3;
    --dark-text: #EAEAEA;
    --dark-text-inverted: #1E1924;
    --dark-hover: #4A3545;
    --dark-hover-subtle: #F5F0F3;
    --dark-pagination-active: #9E4A6A;
    --dark-header-bg: #F5F5F5;
    /* Colors for inversion compensation */
    --dark-pastel-single-invert: #091B00;
    --dark-pastel-double-invert: #F6E4FF;
    /* Accent colors for 90% inversion */
    --dark-accent-inverted: #29996F;
    --dark-accent-secondary-inverted: #1AAA6A;
}

/* ============================================
   Dark Mode Toggle Button
   ============================================ */
#dark {
    float: right;
    color: var(--dark-text);
    margin-right: 8px;
    margin-left: 8px;
    font-weight: bold;
}

/* ============================================
   Manual Dark Mode (body.dark class)
   ============================================ */
html.dark {
    background-color: var(--dark-bg);
}

body.dark {
    filter: invert(90%);
}

/* Icons - double inversion compensation */
body.dark:not(.theme-Rtmaterial) .icon {
    filter: invert(100%);
    color: var(--dark-pastel-double-invert) !important;
}

/* Standalone SVGs (not inside .icon) need inversion */
body.dark svg.icon-svg {
    filter: invert(100%);
}

/* SVGs inside .icon - parent already has filter, don't double-invert */
body.dark .icon svg.icon-svg {
    filter: unset;
}

/* Images and elements that need inversion back */
body.dark .badge,
body.dark img.gravatar,
body.dark img.filecontent.image,
body.dark .wiki img,
body.dark .attachments .images img,
body.dark table.indicator.summary,
body.dark canvas.chartjs-render-monitor {
    filter: invert(100%);
}

body.dark .diff_out,
body.dark .diff_in {
    filter: invert(1);
}

/* Overdue styling */
body.dark table.list tr.overdue td.due_date,
body.dark div.issue.overdue .due-date .value {
    filter: invert(100%);
    color: var(--dark-accent-secondary);
}

/* Header and Top Menu */
body.dark #header,
body.dark #top-menu,
body.dark #project-jump .drdn-trigger {
    color: var(--dark-pastel-single-invert) !important;
    background: transparent !important;
}

body.dark #top-menu {
    background-color: transparent !important;
}

body.dark #top-menu #loggedas {
    color: var(--dark-pastel-single-invert) !important;
}

body.dark #header a,
body.dark #top-menu a,
body.dark #content h1,
body.dark h2,
body.dark h3,
body.dark h4,
body.dark h5,
body.dark h6,
body.dark .wiki a,
body.dark .wiki a:link,
body.dark .wiki a:visited,
body.dark #main a.user {
    color: var(--dark-pastel-single-invert) !important;
}

/* Sidebar */
body.dark #sidebar a.selected {
    background-color: unset !important;
    color: var(--dark-text-inverted);
}

/* Login form */
body.dark #login-form {
    background: unset !important;
    border: unset !important;
}

body.dark .nodata {
    background: unset !important;
}

/* Form inputs */
body.dark input {
    accent-color: var(--dark-accent) !important;
}

body.dark input[type="date"] {
    color-scheme: dark;
}

body.dark input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(100%);
}

/* Issue styling */
body.dark div.issue {
    background: transparent !important;
}

body.dark a.issue,
body.dark a.issue:link,
body.dark a.issue:visited,
body.dark div.wiki .wiki-page,
body.dark div.wiki .external {
    color: var(--dark-accent);
}

/* Flyout menu */
body.dark .flyout-menu {
    background-color: var(--dark-bg-light);
}

/* Buttons and notices */
body.dark input[type="submit"] {
    background-color: var(--dark-accent) !important;
    color: var(--dark-text-inverted) !important;
    border: 1px solid var(--dark-accent) !important;
}

body.dark input[type="submit"]:hover {
    background-color: var(--dark-accent-secondary) !important;
    border-color: var(--dark-accent-secondary) !important;
}

body.dark div.flash.notice {
    background-color: transparent !important;
}

/* Table row hover - subtle effect */
body.dark table.list:not(.odd-even) tbody tr:nth-child(odd):hover,
body.dark .odd:hover,
body.dark #issue-changesets div.changeset:nth-child(odd):hover,
body.dark table.list:not(.odd-even) tbody tr:nth-child(even):hover,
body.dark .even:hover,
body.dark #issue-changesets div.changeset:nth-child(even):hover {
    background-color: var(--dark-hover-subtle);
}

/* Menu hover */
body.dark #main-menu .menu-children li a:hover,
body.dark .pagination ul.pages li.page:hover {
    background-color: var(--dark-hover);
}

/* Content links - accent color for visibility */
body.dark #content a,
body.dark #content a:link,
body.dark #content a:visited {
    color: var(--dark-accent-inverted) !important;
}

body.dark #content a:hover,
body.dark #content a:focus {
    color: var(--dark-accent-secondary-inverted) !important;
}

/* General text colors */
body.dark #main-menu,
body.dark #main-menu li a,
body.dark #main-menu li a.selected,
body.dark #main-menu li a:hover,
body.dark .nodata,
body.dark .warning,
body.dark #errorExplanation,
body.dark #flash_error,
body.dark div.flash.notice,
body.dark #main-menu .menu-children li a:hover,
body.dark .highlight {
    color: var(--dark-text-inverted);
}

/* Main menu backgrounds */
body.dark #main-menu,
body.dark #main-menu li a.selected,
body.dark #main-menu li a:hover,
body.dark #main-menu li a.new-object {
    background: var(--dark-header-bg);
}

/* Tab styling - accent underline for active tab */
body.dark #content .tabs ul li a.selected {
    border-bottom: 3px solid var(--dark-accent) !important;
    background: transparent !important;
}

body.dark #content .tabs ul li a {
    border-bottom: 3px solid transparent;
}

body.dark #content .tabs ul li a:hover {
    border-bottom: 3px solid var(--dark-accent-secondary) !important;
}

/* Border colors */
body.dark #main-menu li a.selected,
body.dark input[type="submit"],
body.dark input[type="submit"]:hover,
body.dark div.flash.notice,
body.dark .ui-widget-header,
body.dark #main-menu .menu-children {
    border-color: var(--dark-accent) !important;
}

/* Pagination */
body.dark .pagination ul.pages li:first-child {
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
}

body.dark .pagination ul.pages li {
    border: 1px solid var(--dark-hover);
}

body.dark .pagination ul.pages li.current {
    color: var(--dark-text);
    background-color: var(--dark-pagination-active);
    border-color: var(--dark-pagination-active);
}

/* Select dropdowns */
body.dark select option,
body.dark select optgroup {
    color: var(--dark-text);
    background-color: var(--dark-bg);
}

/* Progress bar - accent colors */
body.dark table.progress td.closed {
    background-color: var(--dark-accent) !important;
}

body.dark table.progress td.done {
    background-color: var(--dark-accent-secondary) !important;
}

/* Activity links */
body.dark #activity .issue a,
body.dark #activity .issue-note a,
body.dark #activity .issue-edit a,
body.dark #activity .issue-closed a,
body.dark #activity .wiki-page a,
body.dark #activity .news a,
body.dark #activity .attachment a,
body.dark #search-results dt a {
    color: var(--dark-text);
}

/* RTmaterial theme support */
body.dark.theme-Rtmaterial tr.priority-default td.priority {
    border-color: var(--dark-accent-secondary);
}

body.dark.theme-Rtmaterial tr.priority-lowest td.priority {
    border-color: var(--dark-accent);
}

body.dark.theme-Rtmaterial tr.priority-highest td.priority {
    border-color: var(--dark-accent-light);
}

body.dark.theme-Rtmaterial tr.overdue td:first-child,
body.dark.theme-Rtmaterial #my-page tr.overdue td.id {
    border-left: 3px solid var(--dark-accent-secondary) !important;
}

/* ============================================
   Auto Dark Mode (prefers-color-scheme)
   ============================================ */
@media (prefers-color-scheme: dark) {
    /* Hide toggle when auto-dark is active */
    #dark {
        display: none;
    }

    html {
        background-color: var(--dark-bg);
    }

    body {
        filter: invert(90%);
    }

    /* Icons - double inversion compensation */
    body:not(.theme-Rtmaterial) .icon {
        filter: invert(100%);
        color: var(--dark-pastel-double-invert) !important;
    }

    /* Standalone SVGs (not inside .icon) need inversion */
    body svg.icon-svg {
        filter: invert(100%);
    }

    /* SVGs inside .icon - parent already has filter, don't double-invert */
    body .icon svg.icon-svg {
        filter: unset;
    }

    /* Images and elements that need inversion back */
    body .badge,
    body img.gravatar,
    body img.filecontent.image,
    body .wiki img,
    body .attachments .images img,
    body table.indicator.summary,
    body canvas.chartjs-render-monitor {
        filter: invert(100%);
    }

    body .diff_out,
    body .diff_in {
        filter: invert(1);
    }

    /* Overdue styling */
    body table.list tr.overdue td.due_date,
    body div.issue.overdue .due-date .value {
        filter: invert(100%);
        color: var(--dark-accent-secondary);
    }

    /* Header and Top Menu */
    body #header,
    body #top-menu,
    body #project-jump .drdn-trigger {
        color: var(--dark-pastel-single-invert);
        background: transparent !important;
    }

    body #top-menu {
        background-color: transparent !important;
    }

    body #top-menu #loggedas {
        color: var(--dark-pastel-single-invert) !important;
    }

    body #header a,
    body #top-menu a,
    body #content h1,
    body h2,
    body h3,
    body h4,
    body h5,
    body h6,
    body .wiki a,
    body .wiki a:link,
    body .wiki a:visited,
    body #main a.user {
        color: var(--dark-pastel-single-invert) !important;
    }

    /* Sidebar */
    body #sidebar a.selected {
        background-color: unset !important;
        color: var(--dark-text-inverted);
    }

    /* Login form */
    body #login-form {
        background: unset !important;
        border: unset !important;
    }

    body .nodata {
        background: unset !important;
    }

    /* Form inputs */
    body input {
        accent-color: var(--dark-accent) !important;
    }

    body input[type="date"] {
        color-scheme: dark;
    }

    body input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(100%);
    }

    /* Issue styling */
    body div.issue {
        background: transparent !important;
    }

    body a.issue,
    body a.issue:link,
    body a.issue:visited,
    body div.wiki .wiki-page,
    body div.wiki .external {
        color: var(--dark-accent);
    }

    /* Flyout menu */
    body .flyout-menu {
        background-color: var(--dark-bg-light);
    }

    /* Buttons and notices */
    body input[type="submit"] {
        background-color: var(--dark-accent) !important;
        color: var(--dark-text-inverted) !important;
        border: 1px solid var(--dark-accent) !important;
    }

    body input[type="submit"]:hover {
        background-color: var(--dark-accent-secondary) !important;
        border-color: var(--dark-accent-secondary) !important;
    }

    body div.flash.notice {
        background-color: transparent !important;
    }

    /* Table row hover - subtle effect */
    body table.list:not(.odd-even) tbody tr:nth-child(odd):hover,
    body .odd:hover,
    body #issue-changesets div.changeset:nth-child(odd):hover,
    body table.list:not(.odd-even) tbody tr:nth-child(even):hover,
    body .even:hover,
    body #issue-changesets div.changeset:nth-child(even):hover {
        background-color: var(--dark-hover-subtle);
    }

    /* Menu hover */
    body #main-menu .menu-children li a:hover,
    body .pagination ul.pages li.page:hover {
        background-color: var(--dark-hover);
    }

    /* Content links - accent color for visibility */
    body #content a,
    body #content a:link,
    body #content a:visited {
        color: var(--dark-accent-inverted) !important;
    }

    body #content a:hover,
    body #content a:focus {
        color: var(--dark-accent-secondary-inverted) !important;
    }

    /* General text colors */
    body #main-menu,
    body #main-menu li a,
    body #main-menu li a.selected,
    body #main-menu li a:hover,
    body .nodata,
    body .warning,
    body #errorExplanation,
    body #flash_error,
    body div.flash.notice,
    body #main-menu .menu-children li a:hover,
    body .highlight {
        color: var(--dark-text-inverted);
    }

    /* Main menu backgrounds */
    body #main-menu,
    body #main-menu li a.selected,
    body #main-menu li a:hover,
    body #main-menu li a.new-object {
        background: var(--dark-header-bg);
    }

    /* Tab styling - accent underline for active tab */
    body #content .tabs ul li a.selected {
        border-bottom: 3px solid var(--dark-accent) !important;
        background: transparent !important;
    }

    body #content .tabs ul li a {
        border-bottom: 3px solid transparent;
    }

    body #content .tabs ul li a:hover {
        border-bottom: 3px solid var(--dark-accent-secondary) !important;
    }

    /* Border colors */
    body #main-menu li a.selected,
    body input[type="submit"],
    body input[type="submit"]:hover,
    body div.flash.notice,
    body .ui-widget-header,
    body #main-menu .menu-children {
        border-color: var(--dark-accent) !important;
    }

    /* Pagination */
    body .pagination ul.pages li:first-child {
        border-top-left-radius: 4px;
        border-bottom-left-radius: 4px;
    }

    body .pagination ul.pages li {
        border: 1px solid var(--dark-hover);
    }

    body .pagination ul.pages li.current {
        color: var(--dark-text);
        background-color: var(--dark-pagination-active);
        border-color: var(--dark-pagination-active);
    }

    /* Select dropdowns */
    body select option,
    body select optgroup {
        color: var(--dark-text);
        background-color: var(--dark-bg);
    }

    /* Progress bar - accent colors */
    body table.progress td.closed {
        background-color: var(--dark-accent) !important;
    }

    body table.progress td.done {
        background-color: var(--dark-accent-secondary) !important;
    }

    /* Activity links */
    body #activity .issue a,
    body #activity .issue-note a,
    body #activity .issue-edit a,
    body #activity .issue-closed a,
    body #activity .wiki-page a,
    body #activity .news a,
    body #activity .attachment a,
    body #search-results dt a {
        color: var(--dark-text);
    }

    /* RTmaterial theme support */
    body.theme-Rtmaterial tr.priority-default td.priority {
        border-color: var(--dark-accent-secondary);
    }

    body.theme-Rtmaterial tr.priority-lowest td.priority {
        border-color: var(--dark-accent);
    }

    body.theme-Rtmaterial tr.priority-highest td.priority {
        border-color: var(--dark-accent-light);
    }

    body.theme-Rtmaterial tr.overdue td:first-child,
    body.theme-Rtmaterial #my-page tr.overdue td.id {
        border-left: 3px solid var(--dark-accent-secondary) !important;
    }
}
