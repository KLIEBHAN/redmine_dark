/* ============================================
   Deep Purple & Magenta Dark Mode
   Fork: https://github.com/KLIEBHAN/redmine_dark
   Original: https://github.com/fraoustin/redmine_dark
   ============================================ */

/* ============================================
   CSS Custom Properties (Color Palette)
   ============================================ */
:root {
    /* Base colors */
    --dark-bg: #1E1924;
    --dark-bg-light: #2A2430;

    /* Accent colors (as displayed after 90% inversion) */
    --dark-accent: #C46B8C;
    --dark-accent-secondary: #D4849E;
    --dark-accent-light: #E09DB3;

    /* Text colors */
    --dark-text: #EAEAEA;
    --dark-text-dark: #1E1924;

    /* UI colors */
    --dark-hover: #4A3545;
    --dark-hover-subtle: #F5F0F3;
    --dark-pagination-active: #9E4A6A;
    --dark-header-bg: #F5F5F5;

    /* Inversion-compensated colors:
       Formula for 90% inversion: displayed = 229.5 - 0.9 * input
       To get target color after inversion: input = (229.5 - target) / 0.9
    */
    --dark-accent-for-invert: #29996F;         /* displays as #C46B8C after 90% invert */
    --dark-accent-secondary-for-invert: #1AAA6A; /* displays as #D4849E after 90% invert */
    --dark-text-for-invert: #091B00;           /* displays as pastel lavender after 90% invert */

    /* Double inversion (90% body + 100% element = ~10% net):
       For elements with filter:invert(100%) inside inverted body
    */
    --dark-text-for-double-invert: #F6E4FF;
}

/* ============================================
   Dark Mode Toggle Button
   ============================================ */
#dark {
    float: right;
    color: var(--dark-text);
    margin-right: 8px;
    margin-left: 8px;
    font-weight: bold;
}

/* ============================================
   Shared Dark Mode Styles

   Note: Due to CSS limitations, styles must be duplicated
   for body.dark (manual toggle) and @media (auto-detect).
   Both sections should remain synchronized.
   ============================================ */

/* --- MANUAL DARK MODE (body.dark class) --- */

html.dark {
    background-color: var(--dark-bg);
}

body.dark {
    filter: invert(90%);
}

/* Icons - compensate for body inversion */
body.dark:not(.theme-Rtmaterial) .icon {
    filter: invert(100%);
    color: var(--dark-text-for-double-invert) !important;
}

/* SVGs - standalone need inversion, nested don't */
body.dark svg.icon-svg {
    filter: invert(100%);
}

body.dark .icon svg.icon-svg {
    filter: unset;
}

/* Images - restore original colors */
body.dark .badge,
body.dark img.gravatar,
body.dark img.filecontent.image,
body.dark .wiki img,
body.dark .attachments .images img,
body.dark table.indicator.summary,
body.dark canvas.chartjs-render-monitor {
    filter: invert(100%);
}

body.dark .diff_out,
body.dark .diff_in {
    filter: invert(100%);
}

/* Overdue styling */
body.dark table.list tr.overdue td.due_date,
body.dark div.issue.overdue .due-date .value {
    filter: invert(100%);
    color: var(--dark-accent-secondary);
}

/* Header & Top Menu */
body.dark #header,
body.dark #top-menu,
body.dark #project-jump .drdn-trigger {
    color: var(--dark-text-for-invert) !important;
    background: transparent !important;
}

body.dark #top-menu #loggedas {
    color: var(--dark-text-for-invert) !important;
}

body.dark #header a,
body.dark #top-menu a,
body.dark #content h1,
body.dark h2,
body.dark h3,
body.dark h4,
body.dark h5,
body.dark h6,
body.dark #main a.user {
    color: var(--dark-text-for-invert) !important;
}

/* Content links - accent color for visibility */
body.dark #content a,
body.dark #content a:link,
body.dark #content a:visited {
    color: var(--dark-accent-for-invert) !important;
}

body.dark #content a:hover,
body.dark #content a:focus {
    color: var(--dark-accent-secondary-for-invert) !important;
}

/* Issue links - override content links for specific styling */
body.dark #content a.issue,
body.dark #content a.issue:link,
body.dark #content a.issue:visited {
    color: var(--dark-accent-for-invert) !important;
}

/* Wiki links */
body.dark .wiki a,
body.dark .wiki a:link,
body.dark .wiki a:visited {
    color: var(--dark-text-for-invert) !important;
}

/* Buttons - consistent styling for all button types */
body.dark input[type="submit"],
body.dark #content a.icon-add,
body.dark #content a.icon-add:link,
body.dark #content a.icon-add:visited {
    background-color: var(--dark-accent) !important;
    color: var(--dark-text) !important;
    border: 1px solid var(--dark-accent) !important;
    filter: unset !important;
    padding: 4px 8px;
    border-radius: 3px;
    text-decoration: none;
}

body.dark input[type="submit"]:hover,
body.dark #content a.icon-add:hover {
    background-color: var(--dark-accent-secondary) !important;
    border-color: var(--dark-accent-secondary) !important;
}

/* Sidebar */
body.dark #sidebar a.selected {
    background-color: unset !important;
    color: var(--dark-text-dark);
}

/* Login form */
body.dark #login-form {
    background: unset !important;
    border: unset !important;
}

body.dark .nodata {
    background: unset !important;
}

/* Form inputs */
body.dark input {
    accent-color: var(--dark-accent) !important;
}

body.dark input[type="date"] {
    color-scheme: dark;
}

body.dark input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(100%);
}

/* Issue detail */
body.dark div.issue {
    background: transparent !important;
}

/* Flyout menu */
body.dark .flyout-menu {
    background-color: var(--dark-bg-light);
}

/* Flash notice */
body.dark div.flash.notice {
    background-color: transparent !important;
    border-color: var(--dark-accent) !important;
}

/* Table row hover */
body.dark table.list:not(.odd-even) tbody tr:hover,
body.dark .odd:hover,
body.dark .even:hover,
body.dark #issue-changesets div.changeset:hover {
    background-color: var(--dark-hover-subtle);
}

/* Menu hover */
body.dark #main-menu .menu-children li a:hover,
body.dark .pagination ul.pages li.page:hover {
    background-color: var(--dark-hover);
}

/* Main menu */
body.dark #main-menu,
body.dark #main-menu li a,
body.dark #main-menu li a.selected,
body.dark #main-menu li a:hover,
body.dark .nodata,
body.dark .warning,
body.dark #errorExplanation,
body.dark #flash_error,
body.dark div.flash.notice,
body.dark #main-menu .menu-children li a:hover,
body.dark .highlight {
    color: var(--dark-text-dark);
}

body.dark #main-menu,
body.dark #main-menu li a.selected,
body.dark #main-menu li a:hover,
body.dark #main-menu li a.new-object {
    background: var(--dark-header-bg);
}

body.dark #main-menu li a.selected,
body.dark .ui-widget-header,
body.dark #main-menu .menu-children {
    border-color: var(--dark-accent) !important;
}

/* Tabs */
body.dark #content .tabs ul li a {
    border-bottom: 3px solid transparent;
}

body.dark #content .tabs ul li a.selected {
    border-bottom: 3px solid var(--dark-accent) !important;
    background: transparent !important;
}

body.dark #content .tabs ul li a:hover {
    border-bottom: 3px solid var(--dark-accent-secondary) !important;
}

/* Pagination */
body.dark .pagination ul.pages li:first-child {
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
}

body.dark .pagination ul.pages li {
    border: 1px solid var(--dark-hover);
}

body.dark .pagination ul.pages li.current {
    color: var(--dark-text);
    background-color: var(--dark-pagination-active);
    border-color: var(--dark-pagination-active);
}

/* Select dropdowns */
body.dark select option,
body.dark select optgroup {
    color: var(--dark-text);
    background-color: var(--dark-bg);
}

/* Progress bar */
body.dark table.progress td.closed {
    background-color: var(--dark-accent) !important;
}

body.dark table.progress td.done {
    background-color: var(--dark-accent-secondary) !important;
}

/* Activity & Search links */
body.dark #activity dt a,
body.dark #search-results dt a {
    color: var(--dark-text);
}

/* RTmaterial theme support */
body.dark.theme-Rtmaterial tr.priority-default td.priority {
    border-color: var(--dark-accent-secondary);
}

body.dark.theme-Rtmaterial tr.priority-lowest td.priority {
    border-color: var(--dark-accent);
}

body.dark.theme-Rtmaterial tr.priority-highest td.priority {
    border-color: var(--dark-accent-light);
}

body.dark.theme-Rtmaterial tr.overdue td:first-child,
body.dark.theme-Rtmaterial #my-page tr.overdue td.id {
    border-left: 3px solid var(--dark-accent-secondary) !important;
}

/* ============================================
   AUTO DARK MODE (@media prefers-color-scheme)

   Mirrors body.dark styles for system preference
   ============================================ */
@media (prefers-color-scheme: dark) {
    #dark {
        display: none;
    }

    html {
        background-color: var(--dark-bg);
    }

    body {
        filter: invert(90%);
    }

    body:not(.theme-Rtmaterial) .icon {
        filter: invert(100%);
        color: var(--dark-text-for-double-invert) !important;
    }

    body svg.icon-svg {
        filter: invert(100%);
    }

    body .icon svg.icon-svg {
        filter: unset;
    }

    body .badge,
    body img.gravatar,
    body img.filecontent.image,
    body .wiki img,
    body .attachments .images img,
    body table.indicator.summary,
    body canvas.chartjs-render-monitor {
        filter: invert(100%);
    }

    body .diff_out,
    body .diff_in {
        filter: invert(100%);
    }

    body table.list tr.overdue td.due_date,
    body div.issue.overdue .due-date .value {
        filter: invert(100%);
        color: var(--dark-accent-secondary);
    }

    body #header,
    body #top-menu,
    body #project-jump .drdn-trigger {
        color: var(--dark-text-for-invert) !important;
        background: transparent !important;
    }

    body #top-menu #loggedas {
        color: var(--dark-text-for-invert) !important;
    }

    body #header a,
    body #top-menu a,
    body #content h1,
    body h2,
    body h3,
    body h4,
    body h5,
    body h6,
    body #main a.user {
        color: var(--dark-text-for-invert) !important;
    }

    body #content a,
    body #content a:link,
    body #content a:visited {
        color: var(--dark-accent-for-invert) !important;
    }

    body #content a:hover,
    body #content a:focus {
        color: var(--dark-accent-secondary-for-invert) !important;
    }

    body #content a.issue,
    body #content a.issue:link,
    body #content a.issue:visited {
        color: var(--dark-accent-for-invert) !important;
    }

    body .wiki a,
    body .wiki a:link,
    body .wiki a:visited {
        color: var(--dark-text-for-invert) !important;
    }

    body input[type="submit"],
    body #content a.icon-add,
    body #content a.icon-add:link,
    body #content a.icon-add:visited {
        background-color: var(--dark-accent) !important;
        color: var(--dark-text) !important;
        border: 1px solid var(--dark-accent) !important;
        filter: unset !important;
        padding: 4px 8px;
        border-radius: 3px;
        text-decoration: none;
    }

    body input[type="submit"]:hover,
    body #content a.icon-add:hover {
        background-color: var(--dark-accent-secondary) !important;
        border-color: var(--dark-accent-secondary) !important;
    }

    body #sidebar a.selected {
        background-color: unset !important;
        color: var(--dark-text-dark);
    }

    body #login-form {
        background: unset !important;
        border: unset !important;
    }

    body .nodata {
        background: unset !important;
    }

    body input {
        accent-color: var(--dark-accent) !important;
    }

    body input[type="date"] {
        color-scheme: dark;
    }

    body input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(100%);
    }

    body div.issue {
        background: transparent !important;
    }

    body .flyout-menu {
        background-color: var(--dark-bg-light);
    }

    body div.flash.notice {
        background-color: transparent !important;
        border-color: var(--dark-accent) !important;
    }

    body table.list:not(.odd-even) tbody tr:hover,
    body .odd:hover,
    body .even:hover,
    body #issue-changesets div.changeset:hover {
        background-color: var(--dark-hover-subtle);
    }

    body #main-menu .menu-children li a:hover,
    body .pagination ul.pages li.page:hover {
        background-color: var(--dark-hover);
    }

    body #main-menu,
    body #main-menu li a,
    body #main-menu li a.selected,
    body #main-menu li a:hover,
    body .nodata,
    body .warning,
    body #errorExplanation,
    body #flash_error,
    body div.flash.notice,
    body #main-menu .menu-children li a:hover,
    body .highlight {
        color: var(--dark-text-dark);
    }

    body #main-menu,
    body #main-menu li a.selected,
    body #main-menu li a:hover,
    body #main-menu li a.new-object {
        background: var(--dark-header-bg);
    }

    body #main-menu li a.selected,
    body .ui-widget-header,
    body #main-menu .menu-children {
        border-color: var(--dark-accent) !important;
    }

    body #content .tabs ul li a {
        border-bottom: 3px solid transparent;
    }

    body #content .tabs ul li a.selected {
        border-bottom: 3px solid var(--dark-accent) !important;
        background: transparent !important;
    }

    body #content .tabs ul li a:hover {
        border-bottom: 3px solid var(--dark-accent-secondary) !important;
    }

    body .pagination ul.pages li:first-child {
        border-top-left-radius: 4px;
        border-bottom-left-radius: 4px;
    }

    body .pagination ul.pages li {
        border: 1px solid var(--dark-hover);
    }

    body .pagination ul.pages li.current {
        color: var(--dark-text);
        background-color: var(--dark-pagination-active);
        border-color: var(--dark-pagination-active);
    }

    body select option,
    body select optgroup {
        color: var(--dark-text);
        background-color: var(--dark-bg);
    }

    body table.progress td.closed {
        background-color: var(--dark-accent) !important;
    }

    body table.progress td.done {
        background-color: var(--dark-accent-secondary) !important;
    }

    body #activity dt a,
    body #search-results dt a {
        color: var(--dark-text);
    }

    body.theme-Rtmaterial tr.priority-default td.priority {
        border-color: var(--dark-accent-secondary);
    }

    body.theme-Rtmaterial tr.priority-lowest td.priority {
        border-color: var(--dark-accent);
    }

    body.theme-Rtmaterial tr.priority-highest td.priority {
        border-color: var(--dark-accent-light);
    }

    body.theme-Rtmaterial tr.overdue td:first-child,
    body.theme-Rtmaterial #my-page tr.overdue td.id {
        border-left: 3px solid var(--dark-accent-secondary) !important;
    }
}
